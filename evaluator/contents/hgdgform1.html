<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gender Mainstreaming Review Form</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/hgdgform.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

<div class="container">
    <div class="row">
        <div class="col-12">
            <table class="table table-bordered">
                <tr>
                    <td class="text-center logo-container"><img src="../../assets/img/useplogo.png" class="logo" alt="Logo"></td>
                    <td class="text-center">
                        <div>Republic of the Philippines</div>
                        <div class="uni-name"><h2>University of Southeastern Philippines</h2></div>
                        <div>IÃ±igo St., Bo. Obrero, Davao City 8000</div>
                        <div>Telephone: (082) 227-8192</div>
                        <div>Website: <a href="http://www.usep.edu.ph">www.usep.edu.ph</a></div>
                        <div>Email: <a href="mailto:president@usep.edu.ph">president@usep.edu.ph</a></div>
                    </td>
                </tr>
                <tr>
                    <td colspan="2" class="text-center font-weight-bold">GENDER MAINSTREAMING REVIEW FORM</td>
                </tr>
            </table>
        </div>
    </div>

    <p>Kindly provide all the required information on this form.</p>

    <table class="table table-bordered bg-white">
        <tr>
            <td><strong>TITLE OF PROPOSAL:</strong> <span id="title"></span></td>
        </tr>
        <tr>
            <td><strong>NAME OF THE PROPONENT/S:</strong> <span id="proponent"></span></td>
        </tr>
        <tr>
            <td><strong>OFFICE/UNIT:</strong> <span id="office"></span></td>
        </tr>
        <tr>
            <td><strong>DESCRIPTION:</strong> <span id="description"></span></td>
        </tr>
    </table>

    <table class="table table-bordered bg-white">
        <thead class="thead-light">
            <tr>
                <th scope="col">Item</th>
                <th scope="col">No</th>
                <th scope="col">Partly</th>
                <th scope="col">Yes</th>
                <th scope="col">Score</th>
                <th scope="col">Comments/Recommendations</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>1.0 Involvement of women and men (max score: 2; 1 for each item)</strong></td>
                <td colspan="3"></td>
                <td><span class="subtotal" id="subtotal1">0.0</span></td>
                <td rowspan="1"><textarea class="form-control" rows="2"></textarea></td>
            </tr>
            <tr>
                <td><i>1.1 Participation of women and men in beneficiary groups in problem identification (possible scores: 0, 0.5, 1.0)</i></td>
                <td class="text-center"><input type="radio" name="item2" value="No" class="score-radio"></td>
                <td class="text-center"><input type="radio" name="item2" value="Partly" class="score-radio"></td>
                <td class="text-center"><input type="radio" name="item2" value="Yes" class="score-radio"></td>
                <td><span class="score" id="score2">0.0</span></td>
                <td rowspan="1"><textarea class="form-control" rows="2"></textarea></td>
            </tr>
            <tr>
                <td><i>1.2 Participation of women and men in beneficiary groups in project design (possible scores: 0, 0.5, 1.0)</i></td>
                <td class="text-center"><input type="radio" name="item3" value="No" class="score-radio"></td>
                <td class="text-center"><input type="radio" name="item3" value="Partly" class="score-radio"></td>
                <td class="text-center"><input type="radio" name="item3" value="Yes" class="score-radio"></td>
                <td><span class="score" id="score3">0.0</span></td>
                <td rowspan="1"><textarea class="form-control" rows="2"></textarea></td>
            </tr>
            <tr>
                <td><strong>2.0 Collection of sex-disaggregated and gender-related information (possible scores: 0, 1.0, 2.0)</strong></td>
                <td class="text-center"><input type="radio" name="item4" value="No" class="score-radio"></td>
                <td class="text-center"><input type="radio" name="item4" value="Partly" class="score-radio"></td>
                <td class="text-center"><input type="radio" name="item4" value="Yes" class="score-radio"></td>
                <td><span class="score" id="score4">0.0</span></td>
                <td rowspan="1"><textarea class="form-control" rows="2"></textarea></td>
            </tr>
            <tr>
                <td><strong>3.0 Conduct of gender analysis and identification of gender issues (max score: 2, 1 for each item)</strong></td>
                <td colspan="3"></td>
                <td><span class="subtotal" id="subtotal3">0.0</span></td>
                <td rowspan="1"><textarea class="form-control" rows="2"></textarea></td>
            </tr>
            <tr>
                <td><i>3.1 Analysis of gender gaps and inequalities related to gender roles, perspectives and needs, or access to and control of resources (possible scores: 0, 0.5, 1.0)</i></td>
                <td class="text-center"><input type="radio" name="item6" value="No" class="score-radio"></td>
                <td class="text-center"><input type="radio" name="item6" value="Partly" class="score-radio"></td>
                <td class="text-center"><input type="radio" name="item6" value="Yes" class="score-radio"></td>
                <td><span class="score" id="score6">0.0</span></td>
                <td rowspan="1"><textarea class="form-control" rows="2"></textarea></td>
            </tr>
            <tr>
                <td><i>3.2 Analysis of constraints and opportunities related to women and men's participation in the project (possible scores: 0, 0.5, 1.0)</i></td>
                <td class="text-center"><input type="radio" name="item7" value="No" class="score-radio"></td>
                <td class="text-center"><input type="radio" name="item7" value="Partly" class="score-radio"></td>
                <td class="text-center"><input type="radio" name="item7" value="Yes" class="score-radio"></td>
                <td><span class="score" id="score7">0.0</span></td>
                <td rowspan="1"><textarea class="form-control" rows="2"></textarea></td>
            </tr>
            <tr>
                <td><strong>4.0 Gender equality goals, outcomes, and outputs (possible scores: 0, 1.0, 2.0)</strong><br><i>Does the project have clearly stated gender equality goals, objectives, outcomes, or outputs?</i></td>
                <td class="text-center"><input type="radio" name="item8" value="No" class="score-radio"></td>
                <td class="text-center"><input type="radio" name="item8" value="Partly" class="score-radio"></td>
                <td class="text-center"><input type="radio" name="item8" value="Yes" class="score-radio"></td>
                <td><span class="score" id="score8">0.0</span></td>
                <td rowspan="1"><textarea class="form-control" rows="2"></textarea></td>
            </tr>
            <tr>
                <td><strong>5.0 Matching strategies with gender issues (possible scores: 0, 1.0, 2.0)</strong><br><i>Do the strategies and activities match the gender issues and gender equality goals identified?</i></td>
                <td class="text-center"><input type="radio" name="item9" value="No" class="score-radio"></td>
                <td class="text-center"><input type="radio" name="item9" value="Partly" class="score-radio"></td>
                <td class="text-center"><input type="radio" name="item9" value="Yes" class="score-radio"></td>
                <td><span class="score" id="score9">0.0</span></td>
                <td rowspan="1"><textarea class="form-control" rows="2"></textarea></td>
            </tr>
            <tr>
                <td><strong>6.0 Gender analysis of likely impacts of the project (max score: 2; for each item or question, 0.67)</strong></td>
                <td colspan="3"></td>
                <td><span class="subtotal" id="subtotal6">0.0</span></td>
                <td rowspan="1"><textarea class="form-control" rows="2"></textarea></td>
            </tr>
            <tr>
                <td><i>6.1 Are women and girl children among the direct or indirect beneficiaries (possible scores: 0, 0.33, 0.67)</i></td>
                <td class="text-center"><input type="radio" name="item11" value="No" class="score-radio"></td>
                <td class="text-center"><input type="radio" name="item11" value="Partly" class="score-radio"></td>
                <td class="text-center"><input type="radio" name="item11" value="Yes" class="score-radio"></td>
                <td><span class="score" id="score11">0.0</span></td>
                <td rowspan="1"><textarea class="form-control" rows="2"></textarea></td>
            </tr>
            <tr>
                <td><i>6.2 Has the project considered its long-term impact on women's socioeconomic status and empowerment (possible scores: 0, 0.33, 0.67)</i></td>
                <td class="text-center"><input type="radio" name="item12" value="No" class="score-radio"></td>
                <td class="text-center"><input type="radio" name="item12" value="Partly" class="score-radio"></td>
                <td class="text-center"><input type="radio" name="item12" value="Yes" class="score-radio"></td>
                <td><span class="score" id="score12">0.0</span></td>
                <td rowspan="1"><textarea class="form-control" rows="2"></textarea></td>
            </tr>
            <tr>
                <td><i>6.3 Has the project included strategies for avoiding or minimizing negative impact on women's status and welfare (possible scores: 0, 0.33, 0.67)</i></td>
                <td class="text-center"><input type="radio" name="item13" value="No" class="score-radio"></td>
                <td class="text-center"><input type="radio" name="item13" value="Partly" class="score-radio"></td>
                <td class="text-center"><input type="radio" name="item13" value="Yes" class="score-radio"></td>
                <td><span class="score" id="score13">0.0</span></td>
                <td rowspan="1"><textarea class="form-control" rows="2"></textarea></td>
            </tr>
            <tr>
                <td><strong>7.0 Monitoring targets and indicators (possible scores: 0, 1.0, 2.0)</strong></td>
                <td class="text-center"><input type="radio" name="item14" value="No" class="score-radio"></td>
                <td class="text-center"><input type="radio" name="item14" value="Partly" class="score-radio"></td>
                <td class="text-center"><input type="radio" name="item14" value="Yes" class="score-radio"></td>
                <td><span class="score" id="score14">0.0</span></td>
                <td rowspan="1"><textarea class="form-control" rows="2"></textarea></td>
            </tr>
            <tr>
                <td><strong>8.0 Sex-disaggregated database requirement (possible scores: 0, 1.0, 2.0)</strong><br><i>Does the project M&E system require sex-disaggregated data to be collected?</i></td>
                <td class="text-center"><input type="radio" name="item15" value="No" class="score-radio"></td>
                <td class="text-center"><input type="radio" name="item15" value="Partly" class="score-radio"></td>
                <td class="text-center"><input type="radio" name="item15" value="Yes" class="score-radio"></td>
                <td><span class="score" id="score15">0.0</span></td>
                <td rowspan="1"><textarea class="form-control" rows="2"></textarea></td>
            </tr>
            <tr>
                <td><strong>9.0 Resources (max score: 2; for each question, 1)</strong></td>
                <td colspan="3"></td>
                <td><span class="subtotal" id="subtotal9">0.0</span></td>
                <td rowspan="1"><textarea class="form-control" rows="2"></textarea></td>
            </tr>
            <tr>
                <td><i>9.1 Is the project's budget allotment sufficient for gender equality promotion or integration? OR, will the project tap counterpart funds from LGUs/partners for its GAD efforts? (possible scores: 0, 0.5, 1.0)</i></td>
                <td class="text-center"><input type="radio" name="item17" value="No" class="score-radio"></td>
                <td class="text-center"><input type="radio" name="item17" value="Partly" class="score-radio"></td>
                <td class="text-center"><input type="radio" name="item17" value="Yes" class="score-radio"></td>
                <td><span class="score" id="score17">0.0</span></td>
                <td rowspan="1"><textarea class="form-control" rows="2"></textarea></td>
            </tr>
            <tr>
                <td><i>9.2 Does the project have the expertise in promoting gender equality and women's empowerment? OR, does the project commit itself to investing project staff time in building capacities within the project to integrate GAD or promote gender equality? (possible scores: 0, 0.5, 1.0)</i></td>
                <td class="text-center"><input type="radio" name="item18" value="No" class="score-radio"></td>
                <td class="text-center"><input type="radio" name="item18" value="Partly" class="score-radio"></td>
                <td class="text-center"><input type="radio" name="item18" value="Yes" class="score-radio"></td>
                <td><span class="score" id="score18">0.0</span></td>
                <td rowspan="1"><textarea class="form-control" rows="2"></textarea></td>
            </tr>
            <tr>
                <td><strong>10.0 Relationship with the agency's GAD efforts (max score: 2; for each question or item, 0.67)</strong></td>
                <td colspan="3"></td>
                <td><span class="subtotal" id="subtotal10">0.0</span></td>
                <td rowspan="1"><textarea class="form-control" rows="2"></textarea></td>
            </tr>
            <tr>
                <td><i>10.1 Will the project build on or strengthen the agency/NCRFW/government's commitment to the empowerment of women? (possible scores: 0, 0.33, 0.67)</i><br><i>IF THE AGENCY HAS NO GAD PLAN: Will the project help in the formulation of the implementing agency's GAD plan?</i></td>
                <td class="text-center"><input type="radio" name="item20" value="No" class="score-radio"></td>
                <td class="text-center"><input type="radio" name="item20" value="Partly" class="score-radio"></td>
                <td class="text-center"><input type="radio" name="item20" value="Yes" class="score-radio"></td>
                <td><span class="score" id="score20">0.0</span></td>
                <td rowspan="1"><textarea class="form-control" rows="2"></textarea></td>
            </tr>
            <tr>
                <td><i>10.2 Will the project build on the initiatives or actions of other organizations in the area? (possible scores: 0, 0.33, 0.67)</i></td>
                <td class="text-center"><input type="radio" name="item21" value="No" class="score-radio"></td>
                <td class="text-center"><input type="radio" name="item21" value="Partly" class="score-radio"></td>
                <td class="text-center"><input type="radio" name="item21" value="Yes" class="score-radio"></td>
                <td><span class="score" id="score21">0.0</span></td>
                <td rowspan="1"><textarea class="form-control" rows="2"></textarea></td>
            </tr>
            <tr>
                <td><i>10.3 Does the project have an exit plan that will ensure the sustainability of GAD efforts and benefits? (possible scores: 0, 0.33, 0.67)</i></td>
                <td class="text-center"><input type="radio" name="item22" value="No" class="score-radio"></td>
                <td class="text-center"><input type="radio" name="item22" value="Partly" class="score-radio"></td>
                <td class="text-center"><input type="radio" name="item22" value="Yes" class="score-radio"></td>
                <td><span class="score" id="score22">0.0</span></td>
                <td rowspan="1"><textarea class="form-control" rows="2"></textarea></td>
            </tr>
            <tr>
                <td colspan="4"></td>
                <td><span id="totalScore">0.0</span></td>
                <!--<td><i>Proposed project is gender-sensitive (proposal passes the GAD test).</i></td>-->
                <td><i></i></td>
            </tr>
            <!-- Add more items as needed -->
        </tbody>
    </table>
    <!--<div>Total Score: <span id="totalScore">0.00</span></div>-->
    <div class="text-center no-print">
        <button class="btn btn-primary" id="saveBtn">Save</button>
        <button class="btn btn-primary" id="submitBtn">Submit</button>
    </div>
</div>

<script src="js/print.js"></script>
<script>
$(document).ready(function() {
    const proposalId = getQueryParam('id');
    console.log(proposalId)
    $.ajax({
        url: '../../controller/evaluator/fetch_proposal_details.php?id=' + proposalId,
        type: 'GET',
        dataType: 'text', // Expecting JSON response
        success: function(response1) {
            console.log(proposalId)
            // const data = response; // No need to parse if dataType is 'json'
            const data = JSON.parse(response1);
            console.log(data)
            console.log("ADHD")
            $('#title').text(data.title);
            $('#proponent').text(data.proponent_name);
            $('#office').text(data.office);
            $('#description').text(data.description);
            // $.ajax({
            //     url: '../../controller/evaluator/fetch_proposal_details.php?id=' + data[0].proposer_id,
            //     type: 'GET',
            //     dataType: 'json', // Expecting JSON response
            //     success: function(response1) {
            //         const response2 = response1; // No need to parse if dataType is 'json'
            //         $('#title').text(response2.title);
            //         $('#proponent').text(response2.proponent_name);
            //         $('#office').text(response2.college_office);
            //     },
            //     error: function(xhr, status, error) {
            //         console.error('Error fetching proposal details:', error);
            //         alert('Error fetching proposal details. Please try again later.');
            //     }
            // });
        },
        error: function(xhr, status, error) {
            console.error('Error fetching document details:', error);
            alert('Error fetching document details. Please try again later.');
        }
    });
    const scores = {
            "No": 0.0,
            "Partly": 0.5,
            "Yes": 1.0,
            "2.0": 2.0,
            "0.67": 0.67,
            "0.33": 0.33
        };

    function updateScore(radio) {
        const name = $(radio).attr('name');
        let scoreValue;
        if (name === 'item4' || name === 'item8' || name === 'item9' || name === 'item14' || name === 'item15') {
            scoreValue = (radio.value === "Yes") ? 2.0 : (radio.value === "Partly") ? 1.0 : 0.0;
        } else if (name === 'item11' || name === 'item12' || name === 'item13' || name === 'item20' || name === 'item21' || name === 'item22') {
            scoreValue = (radio.value === "Yes") ? 0.67 : (radio.value === "Partly") ? 0.33 : 0.0;
        } else {
            scoreValue = scores[radio.value];
        }

        const scoreElementId = 'score' + $(radio).attr('name').replace('item', '');
        $('#' + scoreElementId).text(scoreValue.toFixed(2));
        // calculateTotalScore();
        calculateTotalScore();
    }

    function calculateSubtotal(sectionItems) {
        let subtotal = 0.0;
        sectionItems.forEach(item => {
            subtotal += parseFloat($('#' + item).text());
        });
        return subtotal.toFixed(1);
    }

    function calculateTotalScore() {
        let totalScore = 0.0;
        $('.score').each(function() {
            totalScore += parseFloat($(this).text());
        });
        $('#totalScore').text(totalScore.toFixed(2));

        // Calculate subtotals for specific sections
        const subtotals = {
            'subtotal1': calculateSubtotal(['score2', 'score3']),
            'subtotal3': calculateSubtotal(['score6', 'score7']),
            'subtotal6': calculateSubtotal(['score11', 'score12', 'score13']),
            'subtotal9': calculateSubtotal(['score17', 'score18']),
            'subtotal10': calculateSubtotal(['score20', 'score21', 'score22'])
        };

        // Update subtotals in the HTML
        for (const [subtotalId, subtotalValue] of Object.entries(subtotals)) {
            $('#' + subtotalId).text(subtotalValue);
        }
    }

    $('.score-radio').on('change', function() {
        updateScore(this);
    });

    $('#saveBtn').on('click', function() {
        $('.no-print').hide();
        window.print();
        $('.no-print').show();
    });

    $('#submitBtn').on('click', function() {
        const proposalId = getQueryParam('id');
        if (!proposalId) {
            console.error('Proposal ID not found in the URL.');
            return;
        }
        const scoresData = [];

        $('tbody tr').each(function() {
            const itemName = $(this).find('.score-radio').attr('name');
            const score = $(this).find('.score-radio:checked').val();
            const comment = $(this).find('textarea').val();
            let scoreValue;

            // Apply scoring logic based on the item name
            if (itemName === 'item4' || itemName === 'item8' || itemName === 'item9' || itemName === 'item14' || itemName === 'item15') {
                scoreValue = (score === "Yes") ? 2.0 : (score === "Partly") ? 1.0 : 0.0;
            } else if (itemName === 'item11' || itemName === 'item12' || itemName === 'item13' || itemName === 'item20' || itemName === 'item21' || itemName === 'item22') {
                scoreValue = (score === "Yes") ? 0.67 : (score === "Partly") ? 0.33 : 0.0;
            } else {
                scoreValue = scores[score];
            }

            if (score !== undefined) {
                scoresData.push({
                    "item": itemName,
                    "score": scoreValue, // Use the calculated scoreValue here
                    "comment": comment
                });
            }
        });


        $.ajax({
            url: '../../controller/evaluator/fetch_proposal_details.php?id=' + proposalId,
            type: 'GET',
            dataType: 'json',
            success: function(response) {
                console.log(scoresData)
                const formData = {
                    proposer_id: response.id,
                    evaluator_id: "2",
                    // submisison_id: response.id,
                    document_file: JSON.stringify(scoresData),
                    resources_file: response.document,
                    date_received: response.submitted_at,
                    date_reviewed: new Date().toISOString().slice(0, 10),
                    status: "Completed",
                    // remarks: "Certification Issued",
                    description: response.description,
                    // college_office: "collegeOffice"
                };

                $.ajax({
                    type: 'POST',
                    url: '../../controller/evaluator/save_document.php',
                    data: formData,
                    success: function(response) {
                        console.log(response);
                        console.log("responsible fguckas")
                        alert("saved")
                    },
                    error: function(xhr, status, error) {
                        console.error('Error:', error);
                    }
                });
            },
            error: function(xhr, status, error) {
                console.error('Error:', error);
            }
        });
    });

    function getQueryParam(param) {
        return new URLSearchParams(window.location.search).get(param);
    }
});

</script>
<!-- <script>
    $(document).ready(function() {
        const scores = {
            "No": 0.0,
            "Partly": 0.5,
            "Yes": 1.0,
            "2.0": 2.0,
            "0.67": 0.67,
            "0.33": 0.33
        };

        function updateScore(radio) {
            const name = $(radio).attr('name');
            let scoreValue;
            if (name === 'item4' || name === 'item8' || name === 'item9' || name === 'item14' || name === 'item15') {
                scoreValue = (radio.value === "Yes") ? 2.0 : (radio.value === "Partly") ? 1.0 : 0.0;
            } else if (name === 'item11' || name === 'item12' || name === 'item13' || name === 'item20' || name === 'item21' || name === 'item22') {
                scoreValue = (radio.value === "Yes") ? 0.67 : (radio.value === "Partly") ? 0.33 : 0.0;
            } else {
                scoreValue = scores[radio.value];
            }

            const scoreElementId = 'score' + $(radio).attr('name').replace('item', '');
            $('#' + scoreElementId).text(scoreValue.toFixed(2));
            calculateTotalScore();
        }

        function calculateTotalScore() {
            let totalScore = 0.0;
            $('.score').each(function() {
                totalScore += parseFloat($(this).text());
            });
            $('#totalScore').text(totalScore.toFixed(2));
        }

        $('.score-radio').on('change', function() {
            updateScore(this);
        });
    });
</script> -->

</body>
</html>
